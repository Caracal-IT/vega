var __extends=this&&this.__extends||function(){var t=function(e,r){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r]};return t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(t,e,r,n){function i(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function a(t){try{u(n.next(t))}catch(e){o(e)}}function s(t){try{u(n["throw"](t))}catch(e){o(e)}}function u(t){t.done?r(t.value):i(t.value).then(a,s)}u((n=n.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return u([t,e])}}function u(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;i=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(a[0]===6&&r.label<o[1]){r.label=o[1];o=a;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(a);break}if(o[2])r.ops.pop();r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s];i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};System.register(["./p-f03b8d3f.system.js"],(function(t){"use strict";var e,r,n;return{setters:[function(t){e=t.r;r=t.h;n=t.c}],execute:function(){var i=function(){function t(){}t.prototype.send=function(t,e){var r=e.path.find((function(t){return t.hasAttribute&&t.hasAttribute("wf-element")}));if(!r)return;var n=this.createPayload(t,r,e.path);if(n){console.log("ANALYTICS",n);window.postMessage({type:n.type,page:n.page,control:n.control,value:n.value,path:n.wfPath.map(this.getName)},"*")}};t.prototype.getName=function(t){if(t.id)return t.id;if(t.page&&t.page.name)return t.page.name;return""};t.prototype.createPayload=function(t,e,r){var n=r.filter((function(t){return t.nodeName&&t.nodeName.indexOf("document-fragment")===-1}));var i=n.find((function(t){return t.localName==="sirius-page"}));if(!i)return null;var o=Object.assign({},i.page);var a=n.slice(0,n.indexOf(i)+1);if(!o.name)return null;var s=o.name;var u=e.id;var c=e.value;return{type:t,page:s,control:u,value:c,wfPath:a}};return t}();var o=t("sirius_analytics",function(){function t(t){e(this,t)}t.prototype.analyticsHandler=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){e=t.path.find((function(t){return t.hasAttribute&&t.hasAttribute("wf-element")}));if(!e)return[2];t.path[0].addEventListener("blur",this.onBlur);o.analyticsService.send("click",t);return[2]}))}))};t.prototype.onBlur=function(t){t.target.removeEventListener("blur",this.onBlur);o.analyticsService.send("blur",t)};return t}());o.analyticsService=new i;var a=t("sirius_page",function(){function t(t){e(this,t)}t.prototype.inputHandler=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:this.modelService.setModelValue(t.target["id"],t.target["value"]);if(!this.page.isDirty)return[2];r.label=1;case 1:r.trys.push([1,3,,4]);return[4,this.page.validate(this.page.context)];case 2:r.sent();return[3,4];case 3:e=r.sent();return[3,4];case 4:return[2]}}))}))};t.prototype.renderItem=function(t){return[r(t.tag,Object.assign({"wf-element":true,data:t,error:t["error"],errorMsg:t["errorMessage"],onInput:this.inputHandler.bind(this)},t,{context:this.page["context"],value:this.modelService.getComponentModelValue(t),caption:this.modelService.getInterpolatedValue(t["caption"])})),t.validators?r("span",null,t["errorMessage"]):null]};t.prototype.render=function(){if(this.page&&this.page.components)return this.page.components.map(this.renderItem.bind(this))};Object.defineProperty(t,"style",{get:function(){return"input[wf-element][data-error-style=true]{border:1px solid #000}[wf-element]{margin:0 2px}input[wf-element][error=true][data-error-style=true]{border:1px solid var(--error-color,red);background-color:var(--error-bg-color,pink)}span{display:inline-block;color:var(--error-color,red)}"},enumerable:true,configurable:true});return t}());var s=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.type="ValidationError";return e}return e}(Error);var u=function(){function t(t){this.name=t}return t}();var c=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.validate=function(t,e,r){var n=t.modelService.getModelValue(e.id);if(n==null||n==undefined||n.toString().trim().length==0){e["error"]="true";e["errorMessage"]=r.message;return false}return true};return e}(u);var l=function(){function t(t,e){this.context=t;this.component=e}t.validate=function(e,r){var n=new t(e,r);var i=n.validate();e.container.page=Object.assign({},e.container.page);return i};t.prototype.validate=function(){this.setErrorState(null);if(this.hasValidators())return this.executeValidators();return true};t.prototype.hasValidators=function(){return this.component&&this.component.validators&&this.component.validators.length>0};t.prototype.executeValidators=function(){var e=function(e){var n=t.RegisteredValidators.find((function(t){return t.name===e.name}));if(n&&!n.validate(r.context,r.component,e))return{value:false}};var r=this;for(var n=0,i=this.component.validators;n<i.length;n++){var o=i[n];var a=e(o);if(typeof a==="object")return a.value}return true};t.prototype.setErrorState=function(t){this.component["error"]=t&&t.length>0;this.component["errorMessage"]=t};return t}();l.RegisteredValidators=[new c("Required")];var f=function(){function t(){var e=this;this.type=t.type;this.execute=function(t){t.container.page=null;e.context=t;e.isDirty=false;e.components.filter((function(t){return t.validators})).forEach((function(t){t["error"]="false";t["errorMessage"]=""}));setTimeout((function(){t.container.page=e}),0)};this.validate=function(t){return new Promise((function(r,n){var i=e.components.filter((function(t){return t.validators}));var o=true;e.isDirty=true;for(var a=0,u=i;a<u.length;a++){var c=u[a];o=o&&l.validate(t,c)}if(o)r(true);else n(new s("Validation Failed"))}))}}t.create=function(e){return Object.assign(new t,e)};return t}();f.type="page-activity";var h=function(){function t(){var e=this;this.type=t.type;this.execute=function(t){e.eval(e.expression,t);if(e.next&&e.next.length>0)t.wfService.setNextAction(e.next,e)}}t.create=function(e){return Object.assign(new t,e)};t.prototype.eval=function(t,e){var r=new Function("context","model",t);return r(e,e.model)};return t}();h.type="code-activity";var p=function(t){__extends(e,t);function e(){var r=t.apply(this,arguments)||this;r.type=e.type;r.execute=function(e){var n="return "+r.left+" "+r.equality+" "+r.right+";";var i=t.prototype.eval.call(r,n,e);if(i)e.wfService.setNextAction(r.trueAction,r);else e.wfService.setNextAction(r.falseAction,r)};return r}e.create=function(t){return Object.assign(new e,t)};return e}(h);p.type="decision-activity";var d=function(){function t(t,e){this.rawUrl=t;this.method=e}Object.defineProperty(t.prototype,"url",{get:function(){return this.rawUrl},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"headers",{get:function(){return{"Content-Type":"application/json","api-key":this.apiKey}},enumerable:true,configurable:true});return t}();var v=function(t){__extends(e,t);function e(e,r,n){var i=t.call(this,e,r)||this;i.modelService=n;return i}Object.defineProperty(e.prototype,"url",{get:function(){return this.getUrlWithValuesFromModel()},enumerable:true,configurable:true});e.prototype.getUrlWithValuesFromModel=function(){var t=this.rawUrl;t.match(/{[\w|\.]+}/g).map(this.createValueItem.bind(this)).forEach((function(e){return t=t.replace(e.key,e.value||"")}));return t};e.prototype.createValueItem=function(t){var e=t.substring(1,t.length-1);var r=this.modelService.getValue(e,this.modelService.getModel());return{key:t,value:r}};return e}(d);var y=function(){function t(){var e=this;this.type=t.type;this.execute=function(t){var r=new v(e.url,e.method,t.modelService);return t.http.fetch(r,e.mappings).then((function(){return t.wfService.setNextAction(e.next,e)}))}}t.create=function(e){return Object.assign(new t,e)};return t}();y.type="api-activity";var g=function(){function t(){var e=this;this.type=t.type;this.execute=function(t){var r=e.value||"";if(e.value.startsWith("{")&&e.value.endsWith("}"))r=t.modelService.getValue(e.value.substring(1,e.value.length-1),t.model);t.modelService.setModelValue(e.key,r);t.wfService.setNextAction(e.next,e)}}t.create=function(e){return Object.assign(new t,e)};return t}();g.type="assign-activity";var m=function(){function t(){var e=this;this.type=t.type;this.execute=function(t){return t.container.ipc(e.process,e.next)}}t.create=function(e){return Object.assign(new t,e)};return t}();m.type="ipc-activity";var w=function(){function t(){this.type=t.type;this.execute=function(t){return t.container.completed(t.container.process)}}t.create=function(e){return Object.assign(new t,e)};return t}();w.type="completed-activity";var _=function(){function t(){var e=this;this.type=t.type;this.execute=function(t){var r=e.UUID();t.container.dehydrate(r);if(e.url.indexOf("?")===-1)document.location.href=e.url+"?sessionId="+r;else document.location.href=e.url+"&sessionId="+r}}t.create=function(e){return Object.assign(new t,e)};t.prototype.UUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=Math.random()*16|0,r=t=="x"?e:e&3|8;return r.toString(16)}))};return t}();_.type="redirect-activity";var x=function(){function t(){}t.linkActivities=function(e){e.activities.forEach((function(e){var r=t.activities.find((function(t){return t.type===e.type}));if(r&&r.create)Object.assign(e,r.create(e))}))};return t}();x.activities=[{type:f.type,create:f.create},{type:h.type,create:h.create},{type:p.type,create:p.create},{type:g.type,create:g.create},{type:y.type,create:y.create},{type:m.type,create:m.create},{type:w.type,create:w.create},{type:_.type,create:_.create}];var S=function(){function t(){}t.prototype.setNextAction=function(t,e){this.action=t;if(this.wfChangeHandler)this.wfChangeHandler(this.action,this.process,e)};t.prototype.setProcess=function(t){this.process=t;if(this.wfChangeHandler)this.wfChangeHandler(this.action,this.process,null)};t.prototype.addActivity=function(t,e){var r=x.activities.find((function(e){return e.type===t}));if(!r)x.activities.push({type:t,create:e})};t.prototype.parse=function(t){try{var e=JSON.parse(t);x.linkActivities(e);return e}catch(r){console.error(r);return null}};return t}();var b;(function(t){t["StartLoading"]="START_LOADING";t["EndLoading"]="END_LOADING";t["Error"]="ERROR";t["ValidationError"]="VALIDATION_ERROR"})(b||(b={}));var O=function(){function t(t,e,r){this.messageType=t;this.description=e;this.stack=r}return t}();var E=function(){function t(t,e,r,n,i){this.model=t;this.modelService=e;this.wfService=r;this.http=n;this.container=i}return t}();var M=function(){function t(t,e,r,n){this.http=t;this.wfService=e;this.modelService=r;this.container=n;this.hasError=false;this.context=new E({},this.modelService,this.wfService,this.http,this.container)}t.prototype.handle=function(){this.wfService.wfChangeHandler=this.handleWfChange.bind(this);this.modelService.modelChangedHandler=this.handleModelChanged.bind(this)};t.prototype.handleWfChange=function(t,e,r){this.hasError=false;this.currProcess=e;this.currAction=t||"start";this.executeActivity(r)};t.prototype.handleModelChanged=function(t){this.context.model=t};t.prototype.executeActivity=function(t){var e=this;if(!this.hasActivities())return;var r=this.currProcess.activities.find((function(t){return t.name===e.currAction}));if(this.canExecute(r)){this.hasError=false;this.sendMessage(new O(b.StartLoading,"Loading..."));this.validate(t).then((function(){return r.execute(e.context)})).then((function(){return e.actionExecuted()})).catch((function(t){return e.handleError(t)}))}};t.prototype.validate=function(t){return __awaiter(this,void 0,void 0,(function(){var e;var r=this;return __generator(this,(function(n){if(this.shouldSkipValidate(t))return[2,true];e=this.currProcess.activities.find((function(t){return t.name===r.lastAction}));if(e&&e.validate)return[2,e.validate(this.context)];return[2]}))}))};t.prototype.shouldSkipValidate=function(t){return t&&t.data&&t.data.noValidate||this.currAction===this.lastAction};t.prototype.actionExecuted=function(){this.sendMessage(new O(b.EndLoading));if(!this.hasError)this.lastAction=this.currAction};t.prototype.handleError=function(t){this.hasError=true;this.modelService.setModelValue("message",new O(b.EndLoading,t.message));if(t instanceof s)this.sendMessage(new O(b.ValidationError,t.message,t.stack));else this.sendMessage(new O(b.Error,t.message,t.stack))};t.prototype.hasActivities=function(){return this.currProcess&&this.currProcess.activities};t.prototype.canExecute=function(t){return t&&t.execute};t.prototype.sendMessage=function(t){this.modelService.setModelValue("message",t);this.context.container.wfMessage.emit(t)};return t}();var I=function(){function t(){this.model={};this.onInput=this.inputHandler.bind(this)}t.prototype.setModelValue=function(t,e){this.model=this.merge(this.model,t,e);if(this.modelChangedHandler)this.modelChangedHandler(this.model)};t.prototype.getComponentModelValue=function(t){var e=this.getModel();var r;if(t&&t.id&&e)r=this.getModelValue(t.id);if(r===undefined&&t.value){r=t.value;this.setModelValue(t.id,r)}return r};t.prototype.getModelValue=function(t){return this.getValue(t,this.getModel())};t.prototype.getInterpolatedValue=function(t){var e=this;if(!t)return t;var r=/\{\{(?:\w+)\}\}/g;var n=t.match(r);if(!n||n.length===0)return t;return n.reduce((function(t,r){return e.replaceAll(t,r)}),t)};t.prototype.getModel=function(){return Object.assign({},this.model)};t.prototype.setModel=function(t){this.model=Object.assign({},t)};t.prototype.getValue=function(t,e){return t.split(".").reduce((function(t,e){return t?t[e]:undefined}),e)};t.prototype.replaceAll=function(t,e){var r=this.getModelValue(e.substring(2,e.length-2));return t.replace(e,r)};t.prototype.inputHandler=function(t){var e=t.currentTarget;var r=e.closest("[wf-element]");this.setModelValue(r.id,r["value"])};t.prototype.merge=function(t,e,r){if(!e)return;var n=Object.assign({},t);e.split(".").reduce((function(t,e,n,i){t[e]=n==i.length-1?r:Object.assign({},t[e]);return t[e]}),n);return n};return t}();var V;(function(t){t["GET"]="get";t["POST"]="post";t["PUT"]="put";t["DELETE"]="delete";t["PATCH"]="patch"})(V||(V={}));var A=function(){function t(t){this.http=t}t.prototype.load=function(t){var e=new d(this.baseUrl+"\\"+t,V.GET);e.apiKey=this.apiKey;return this.http.fetchData(e)};return t}();var H;(function(t){t["In"]="in";t["Out"]="out";t["InOut"]="inout"})(H||(H={}));var P=function(){function t(t){this.modelService=t}t.prototype.fetchData=function(t,e){if(e===void 0){e=null}return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,this.fetch(t,null,e,false)]}))}))};t.prototype.fetch=function(t,e,r,n){if(e===void 0){e=null}if(r===void 0){r=null}if(n===void 0){n=true}return __awaiter(this,void 0,void 0,(function(){var i,o;return __generator(this,(function(a){switch(a.label){case 0:return[4,fetch(t.url,this.getConfig(t,e,r))];case 1:i=a.sent();return[4,i.json()];case 2:o=a.sent();if(!this.modelService||!n)return[2,o];return[2,this.setModelValues(o,e)]}}))}))};t.prototype.getConfig=function(t,e,r){if(r===void 0){r=null}return{method:t.method,mode:"cors",headers:t.headers,redirect:"follow",referrer:"no-referrer",body:r?JSON.stringify(r):this.getBody(t,e)}};t.prototype.getBody=function(t,e){var r=this;if(t.method===V.GET||t.method===V.DELETE)return null;var n={};var i=this.modelService.getModel();e.filter((function(t){return t.direction===H.Out||t.direction===H.InOut})).forEach((function(t){var e;return Object.assign(n,(e={},e[t.client]=r.modelService.getValue(t.client,i),e))}));return JSON.stringify(n)};t.prototype.setModelValues=function(t,e){var r=this;if(!e||e.length===0)return Object.keys(t).forEach((function(e){return r.modelService.setModelValue(e,t[e])}));e.filter((function(t){return t.direction===H.Out||t.direction===H.InOut})).forEach((function(e){return r.modelService.setModelValue(e.client,r.modelService.getValue(e.remote,t))}))};return t}();var j=function(){function t(){}t.prototype.setItem=function(t,e){sessionStorage.setItem(t,JSON.stringify(e))};t.prototype.getItem=function(t){var e=sessionStorage.getItem(t);if(!e)return null;return JSON.parse(e)};t.prototype.clear=function(){sessionStorage.clear()};return t}();var C=t("sirius_wf",function(){function t(t){e(this,t);this.ipcHistory=[];this.wfMessage=n(this,"wfMessage",7)}t.prototype.addActivity=function(t,e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){this.wfService.addActivity(t,e);return[2]}))}))};t.prototype.goto=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.wfService.setNextAction(t,this);return[2]}))}))};t.prototype.loadProcess=function(t,e){if(e===void 0){e="start"}return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){this.page=null;this.wfService.setProcess(t);this.goto(e);return[2]}))}))};t.prototype.parse=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.wfService.parse(t)]}))}))};t.prototype.load=function(t,e){if(e===void 0){e="start"}return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){if(typeof t==="object")t=JSON.stringify(t);r=this.wfService.parse(t);if(!r)return[2];return[2,this.loadProcess(r,e)]}))}))};t.prototype.loadUrl=function(t,e){if(e===void 0){e="start"}return __awaiter(this,void 0,void 0,(function(){var r,n;return __generator(this,(function(i){switch(i.label){case 0:i.trys.push([0,3,,4]);r=this.load;return[4,this.wfLoaderHandler.load(t)];case 1:return[4,r.apply(this,[i.sent(),e])];case 2:i.sent();this.process=t;return[3,4];case 3:n=i.sent();return[3,4];case 4:return[2]}}))}))};t.prototype.hydrate=function(t,e,r){if(r===void 0){r="start"}return __awaiter(this,void 0,void 0,(function(){var n,i;return __generator(this,(function(o){n=this.persistance.getItem(e+"_IPC")||[];i=this.persistance.getItem(e+"_MODEL")||this.modelService.getModel();this.loadUrl(t,r);this.ipcHistory=n;this.modelService.setModel(i);return[2]}))}))};t.prototype.dehydrate=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.persistance.clear();this.persistance.setItem(t+"_IPC",this.ipcHistory);this.persistance.setItem(t+"_MODEL",this.modelService.getModel());return[2]}))}))};t.prototype.ipc=function(t,e){if(e===void 0){e=null}return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);this.ipcHistory.push(new L(this.process,t,e));this.persistance.setItem("WF_SIRIUS_IPC",this.ipcHistory);return[4,this.loadUrl(t,"start")];case 1:n.sent();return[3,3];case 2:r=n.sent();return[3,3];case 3:return[2]}}))}))};t.prototype.completed=function(t){return __awaiter(this,void 0,void 0,(function(){var e,r;return __generator(this,(function(n){switch(n.label){case 0:e=this.ipcHistory.pop();this.persistance.setItem("WF_SIRIUS_IPC",this.ipcHistory);if(!e||e.process!==t){this.ipcHistory=[];this.persistance.setItem("WF_SIRIUS_IPC",this.ipcHistory);return[2]}n.label=1;case 1:n.trys.push([1,3,,4]);return[4,this.loadUrl(e.parent,e.next||"start")];case 2:n.sent();return[3,4];case 3:r=n.sent();return[3,4];case 4:return[2]}}))}))};t.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.persistance=new j;this.wfService=new S;this.modelService=new I;this.http=new P(this.modelService);this.wfHandler=new M(this.http,this.wfService,this.modelService,this);this.wfHandler.handle();this.wfLoaderHandler=new A(this.http);this.wfLoaderHandler.apiKey=this.apiKey;this.wfLoaderHandler.baseUrl=this.baseUrl;if(this.process)this.loadUrl(this.process);return[2]}))}))};t.prototype.render=function(){return r("sirius-page",{page:this.page,modelService:this.modelService})};return t}());var L=function(){function t(t,e,r){this.parent=t;this.process=e;this.next=r}return t}()}}}));